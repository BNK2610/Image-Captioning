[2024-12-07 02:06:17,143][src.utils.utils][INFO] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>
[2024-12-07 02:06:17,300][src.utils.utils][INFO] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>
[2024-12-07 02:06:17,445][__main__][INFO] - [rank: 0] Instantiating datamodule <src.data.ImageCaptionDataModule>
[2024-12-07 02:06:18,789][__main__][INFO] - [rank: 0] Instantiating model <src.models.ImageCaptionModule>
[2024-12-07 02:06:23,686][__main__][INFO] - [rank: 0] Instantiating callbacks...
[2024-12-07 02:06:23,687][src.utils.instantiators][INFO] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>
[2024-12-07 02:06:23,691][src.utils.instantiators][INFO] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>
[2024-12-07 02:06:23,693][src.utils.instantiators][INFO] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>
[2024-12-07 02:06:23,693][src.utils.instantiators][INFO] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>
[2024-12-07 02:06:23,695][__main__][INFO] - [rank: 0] Instantiating loggers...
[2024-12-07 02:06:23,695][src.utils.instantiators][INFO] - [rank: 0] Instantiating logger <lightning.pytorch.loggers.wandb.WandbLogger>
[2024-12-07 02:06:23,701][__main__][INFO] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>
[2024-12-07 02:06:23,740][__main__][INFO] - [rank: 0] Logging hyperparameters!
[2024-12-07 02:06:26,463][__main__][INFO] - [rank: 0] Starting training!
[2024-12-07 02:08:19,925][src.utils.utils][ERROR] - [rank: 0] 
Traceback (most recent call last):
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\trainer\call.py", line 47, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\trainer\trainer.py", line 574, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\trainer\trainer.py", line 981, in _run
    results = self._run_stage()
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\trainer\trainer.py", line 1025, in _run_stage
    self.fit_loop.run()
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\loops\fit_loop.py", line 205, in run
    self.advance()
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\loops\fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\loops\training_epoch_loop.py", line 140, in run
    self.advance(data_fetcher)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\loops\training_epoch_loop.py", line 250, in advance
    batch_output = self.automatic_optimization.run(trainer.optimizers[0], batch_idx, kwargs)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\loops\optimization\automatic.py", line 190, in run
    self._optimizer_step(batch_idx, closure)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\loops\optimization\automatic.py", line 268, in _optimizer_step
    call._call_lightning_module_hook(
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\trainer\call.py", line 167, in _call_lightning_module_hook
    output = fn(*args, **kwargs)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\core\module.py", line 1306, in optimizer_step
    optimizer.step(closure=optimizer_closure)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\core\optimizer.py", line 153, in step
    step_output = self._strategy.optimizer_step(self._optimizer, closure, **kwargs)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\strategies\strategy.py", line 238, in optimizer_step
    return self.precision_plugin.optimizer_step(optimizer, model=model, closure=closure, **kwargs)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\plugins\precision\precision.py", line 122, in optimizer_step
    return optimizer.step(closure=closure, **kwargs)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\torch\optim\optimizer.py", line 487, in wrapper
    out = func(*args, **kwargs)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\torch\optim\optimizer.py", line 91, in _use_grad
    ret = func(self, *args, **kwargs)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\torch\optim\adam.py", line 223, in step
    adam(
  File "C:\anaconda3\envs\image-caption\lib\site-packages\torch\optim\optimizer.py", line 154, in maybe_fallback
    return func(*args, **kwargs)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\torch\optim\adam.py", line 784, in adam
    func(
  File "C:\anaconda3\envs\image-caption\lib\site-packages\torch\optim\adam.py", line 611, in _multi_tensor_adam
    exp_avg_sq_sqrt = torch._foreach_sqrt(device_exp_avg_sqs)
RuntimeError: CUDA error: unknown error
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Image-Captioning\src\utils\utils.py", line 68, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
  File "C:\Image-Captioning\src\train.py", line 87, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\trainer\trainer.py", line 538, in fit
    call._call_and_handle_interrupt(
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\trainer\call.py", line 68, in _call_and_handle_interrupt
    trainer._teardown()
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\trainer\trainer.py", line 1004, in _teardown
    self.strategy.teardown()
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\pytorch\strategies\strategy.py", line 535, in teardown
    self.lightning_module.cpu()
  File "C:\anaconda3\envs\image-caption\lib\site-packages\lightning\fabric\utilities\device_dtype_mixin.py", line 82, in cpu
    return super().cpu()
  File "C:\anaconda3\envs\image-caption\lib\site-packages\torch\nn\modules\module.py", line 1118, in cpu
    return self._apply(lambda t: t.cpu())
  File "C:\anaconda3\envs\image-caption\lib\site-packages\torch\nn\modules\module.py", line 900, in _apply
    module._apply(fn)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\torch\nn\modules\module.py", line 900, in _apply
    module._apply(fn)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\torch\nn\modules\module.py", line 900, in _apply
    module._apply(fn)
  [Previous line repeated 4 more times]
  File "C:\anaconda3\envs\image-caption\lib\site-packages\torch\nn\modules\module.py", line 927, in _apply
    param_applied = fn(param)
  File "C:\anaconda3\envs\image-caption\lib\site-packages\torch\nn\modules\module.py", line 1118, in <lambda>
    return self._apply(lambda t: t.cpu())
RuntimeError: [enforce fail at alloc_cpu.cpp:114] data. DefaultCPUAllocator: not enough memory: you tried to allocate 786432 bytes.
[2024-12-07 02:08:20,040][src.utils.utils][INFO] - [rank: 0] Output dir: C:\Image-Captioning\logs\train\runs\2024-12-07_02-06-17
[2024-12-07 02:08:20,041][src.utils.utils][INFO] - [rank: 0] Closing wandb!
